---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';

// Obtener proyectos de la colección y ordenarlos
const projects = (await getCollection('projects')).sort(
  (a, b) => a.data.order - b.data.order
);
---

<section id="projects" class="section fade-in-section" aria-labelledby="projects-title">
  <div class="container">
    <h2 id="projects-title" class="section-title scroll-animation from-bottom">PROYECTOS</h2>
    <div class="projects-grid">
      {projects.map((project, index) => {
        // Generar delay dinámicamente basado en el índice
        const delay = `delay-${(index % 4) + 1}`;
        
        return (
          <article class={`project-card scroll-animation from-left ${delay}`} data-project-id={project.data.order}>
            <div class="project-tilt-container">
              <div class="project-image-container">
                <Image
                  src={project.data.image}
                  alt={project.data.alt}
                  class="project-image"
                  width={400}
                  height={225}
                  densities={[1, 1.5, 2]}
                  formats={['avif', 'webp']}
                  quality="mid"
                  loading="lazy"
                />
              </div>
              <div class="project-color-overlay"></div>
              <div class="project-pattern"></div>
              <div class="project-number">{String(index + 1).padStart(2, '0')}</div>
              <div class="project-content">
                <div class="project-title-container">
                  <h3 class="project-title">{project.data.title}</h3>
                </div>
                <div class="project-description">
                  {project.data.description}
                </div>
                <div class="project-links">
                  <a
                    href={project.data.repository}
                    class="project-link"
                    target="_blank"
                    rel="noopener"
                    aria-label={`Ver código fuente de ${project.data.title} en GitHub`}
                  >
                    Repositorio
                  </a>
                </div>
              </div>
              <div class="project-shine"></div>
            </div>
          </article>
        );
      })}
    </div>
  </div>
</section>
